// Generated by CoffeeScript 1.7.1
var bbContext, bbFocus, canvasHeight, canvasWidth, centered, clicked, contextFrameMask, contextInnerFrame, contextOuterFrame, focusFrame, loadStations, loadStats, mapX, mapY, margin, path, projection, svg;

margin = {
  top: 20,
  right: 20,
  bottom: 20,
  left: 20
};

canvasWidth = 1200 - margin.left - margin.right;

canvasHeight = 800 - margin.bottom - margin.top;

svg = d3.select("#visualization").append("svg").attr("width", canvasWidth + margin.left + margin.right).attr("height", canvasHeight + margin.top + margin.top).append("g").attr("transform", "translate(" + margin.left + ", " + margin.top + ")");

bbContext = {
  x: 0,
  y: 0,
  width: canvasWidth,
  height: 500
};

contextOuterFrame = svg.append("g").attr("transform", "translate(" + bbContext.x + ", " + bbContext.y + ")");

contextOuterFrame.append("clipPath").attr("id", "clip").append("rect").attr("width", bbContext.width).attr("height", bbContext.height);

contextFrameMask = contextOuterFrame.append("g").attr("clip-path", "url(#clip)");

contextInnerFrame = contextFrameMask.append("g").attr("width", bbContext.width).attr("height", bbContext.height);

contextInnerFrame.append("rect").attr("id", "contextBackground").attr("width", bbContext.width).attr("height", bbContext.height).on("click", clicked);

bbFocus = {
  x: 0,
  y: 500,
  width: canvasWidth,
  height: 300
};

focusFrame = svg.append("g").attr("transform", "translate(" + bbFocus.x + ", " + bbFocus.y + ")");

mapX = bbContext.width / 2;

mapY = bbContext.height / 2;

projection = d3.geo.albersUsa().translate([mapX, mapY]);

path = d3.geo.path().projection(projection);

centered = null;

clicked = function(d) {
  var centroid, k, x, y, _ref;
  _ref = [0, 0, 0], x = _ref[0], y = _ref[1], k = _ref[2];
  if (d && (centered !== d)) {
    centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 4;
    centered = d;
  } else {
    x = mapX;
    y = mapY;
    k = 1;
    centered = null;
  }
  contextInnerFrame.selectAll("path").classed("active", centered && (function(d) {
    return d === centered;
  }));
  return contextInnerFrame.transition().duration(750).attr("transform", "translate(" + mapX + ", " + mapY + ")scale(" + k + ")translate(" + (-x) + ", " + (-y) + ")").style("stroke-width", "" + (1.5 / k) + "px");
};

loadStations = function() {
  return d3.csv("../data/NSRDB_StationsMeta.csv", function(error, data) {});
};

loadStats = function() {
  return d3.json("../data/reducedMonthStationHour2003_2004.json", function(error, data) {
    var completeDataSet;
    completeDataSet = data;
    return loadStations();
  });
};

d3.json("../data/us-named.json", function(data) {
  contextInnerFrame.append("g").attr("id", "states").selectAll("path").data(topojson.feature(data, data.objects.states).features).enter().append("path").attr("class", "state").attr("d", path).on("click", clicked);
  return contextInnerFrame.append("path").datum(topojson.mesh(data, data.objects.states, function(a, b) {
    return a !== b;
  })).attr("id", "state-borders").attr("d", path);
});
